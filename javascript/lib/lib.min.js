(function(d){function c(a,b,e){this.elem=a;this.id=e;this.init(a,b)}c.prototype.init=function(a,b){this.options=d.extend({frequency:1,fade_time:null,wait_image:!1,waiting_image:"img/loading.gif",minimum_wait:1},b);this.options.fade_time*=1E3;this.options.frequency*=1E3;this.options.minimum_wait*=1E3;this.obj={timer_id:null};this.create()};c.prototype.create=function(){var a=this;a.obj.timer_id=setInterval(function(){var b=d(window).scrollTop()+d(window).height();if(d(a.elem).position().top+parseInt(d(a.elem).height())<
b){var e=d(document.createElement("img"));if(a.options.wait_image){a.addToDom(e);e.attr("src",a.options.waiting_image);var c=setInterval(function(){a.loadImage(e);clearInterval(c)},a.options.minimum_wait)}else a.loadImage(e),a.addToDom(e);clearInterval(a.obj.timer_id)}},a.options.frequency)};c.prototype.loadImage=function(a){var b=this;null!=b.options.fade_time&&(a.hide(),a.load(function(){d(this).fadeIn(b.options.fade_time)}));var e=d(b.elem).attr("href"),c=d(b.elem).attr("id"),f=d(b.elem).attr("rel");
a.attr("src",e);a.attr("id",c);a.attr("alt",f)};c.prototype.addToDom=function(a){d(this.elem).after(a);d(this.elem).remove()};jQuery(document).ready(function(a){jQuery.fn.inf_img=function(a){var e=jQuery(this).selector;return this.each(function(){jQuery.data(this,e,new c(this,a,e))})}})})(jQuery);
(function(d){function c(a,b,e){this.elem=a;this.id=e;this.init(a,b)}c.prototype.init=function(a,b){this.options=d.extend({src:null,theme:null,width:250,height:250,speed:0.001,scroll_animate:!1,bg_color:null,padding:0,pop_ups:!1,stroke:"none",bar_palette:["#222","#444","#666","#888","#AAA"],alpha:0.9,label_lines:!0,label_lines_font_size:10,label_lines_font_color:"#333",label_bars:!0,label_bars_font_size:10,label_bars_color:"#333",draw_lines:!0,line_color:"#333"},b);if(null!=this.options.theme){var e=
this.theme(this.options.theme);this.options=d.extend(this.options,e)}this.options.speed*=1E3;this.width=this.options.width-2*this.options.padding;this.height=this.options.height-2*this.options.padding;this.dataset={};this.barWidth=this.heightCoeff=this.total=this.inc=this.max=this.largest=0;this.bardata={};this.totalColors=this.options.bar_palette.length;this.totalLines=0;this.bg=null;this.popUps={};this.chartId=d(this.elem).attr("id");this.barIdMap=this.timerId=null;this.create()};c.prototype.create=
function(){this.paper=Raphael(this.chartId,this.options.width,this.options.height);this.redraw();!0==this.options.scroll_animate&&this.scrollAnimationSetup();!0==this.options.pop_ups&&this.clickBgPopupClear()};c.prototype.clickBgPopupClear=function(){var a=this;d(a.elem).click(function(b){var e=b.offsetX||b.clientX-d(b.target).offset().left;b=b.offsetY||b.clientY-d(b.target).offset().top;var c=null,f;for(f in a.bardata)e>a.bardata[f].x&&(c=a.bardata[f]);null!=c&&b<c.y&&a.clearPopUps()})};c.prototype.src=
function(a){this.options.src=a;this.redraw()};c.prototype.scrollAnimationSetup=function(){var a=this;a.timerId=setInterval(function(){var b=d(window).scrollTop()+d(window).height();d(a.elem).position().top+parseInt(d(a.elem).height())<b&&(a.drawBars(),clearInterval(a.timerId))},250)};c.prototype.redraw=function(){this.grabData();this.calculate();this.draw()};c.prototype.draw=function(){this.paper.clear();null!=this.options.bg_color&&this.drawBg();this.options.draw_lines&&this.drawLines();this.options.label_lines&&
this.drawLineLabels();!1==this.options.scroll_animate&&this.drawBars();this.options.label_bars&&this.drawBarLabels()};c.prototype.drawBg=function(){this.bg=this.paper.rect(0,0,this.options.width,this.options.height);this.bg.attr({fill:this.options.bg_color,stroke:"none"})};c.prototype.barPalette=function(a){this.options.bar_palette=a;this.totalColors=a.length;a=this.options.speed;this.options.speed=0.001;this.redraw();this.options.speed=a};c.prototype.bgColor=function(a){this.options.bg_color=a;a=
this.options.speed;this.options.speed=0.001;this.draw();this.options.speed=a};c.prototype.grabData=function(){var a=this;a.largest=0;a.dataset={};a.total=0;d("th",a.options.src).each(function(){var b=d(this).text(),e=parseInt(d("td",a.options.src).eq(a.total).text());a.largest=e>a.largest?e:a.largest;a.dataset[b]=e;a.total++})};c.prototype.calculate=function(){this.barHeightMax=this.height;this.options.label_bars&&(this.barHeightMax=this.height-1.5*this.options.label_bars_font_size);this.max=this.closestZeroes(this.largest);
this.totalLines=parseInt(this.max.toString().slice(0,1));this.inc=Math.pow(10,this.max.toString().length-1);3>this.totalLines?(this.totalLines*=4,this.inc/=4):5>this.totalLines&&(this.totalLines*=2,this.inc/=2);this.lineSpacer=this.barHeightMax/this.totalLines;this.heightCoeff=this.barHeightMax/this.max;this.startX=0+this.options.padding;this.barWidth=this.width/this.total;this.options.label_lines&&(this.barWidth=this.width/(this.total+1),this.startX+=this.barWidth)};c.prototype.drawBars=function(){var a=
this,b=0,e=[];a.barIdMap={};for(var c in a.dataset){var d=a.dataset[c]*a.heightCoeff,g=a.barWidth*b+a.startX,h=a.barHeightMax-d+a.options.padding,k=a.options.bar_palette[b>a.totalColors-1?b%a.totalColors:b];a.bardata[c]={};a.bardata[c].height=d;a.bardata[c].x=g;a.bardata[c].y=h;a.bardata[c].color=k;e[b]=a.paper.rect(g,a.barHeightMax,a.barWidth,0);a.barIdMap[e[b].id]=c;e[b].attr({fill:k,stroke:a.options.stroke,"fill-opacity":a.options.alpha});e[b].animate({height:d,y:h},a.options.speed);!0==a.options.pop_ups&&
e[b].click(function(b){a.drawPopUp(a.barIdMap[this.id])});b++}};c.prototype.clearPopUps=function(){for(var a in this.popUps)this.popUps[a].text.remove(),this.popUps[a].bg.remove(),this.popUps[a].tri.remove()};c.prototype.drawPopUp=function(a){this.clearPopUps();var b=this.bardata[a].x,c=this.bardata[a].y,d=10*this.dataset[a].toString().length;this.popUps[a]={};this.popUps[a].bg=this.paper.rect(b+5,c+12,d,20);this.popUps[a].text=this.paper.text(b+10,c+22,this.dataset[a]);this.popUps[a].tri=this.paper.path(["M",
b+15,c,"L",b+20,c+13,"L",b+10,c+13]);this.popUps[a].length=d;this.popUps[a].tri.attr({stroke:"none",fill:"#fff",opacity:1});this.popUps[a].bg.attr({stroke:"none",fill:"#fff",opacity:1,width:this.popUps[a].length,height:20});this.popUps[a].text.attr({fill:"#000",opacity:1,"text-anchor":"start"})};c.prototype.drawLines=function(){for(var a=1;a<this.totalLines;){var b=a*this.lineSpacer+this.options.padding;this.paper.path(["M",this.options.padding,b,"L",this.width+this.options.padding,b]).attr({stroke:this.options.line_color,
"stroke-width":0.5});a++}};c.prototype.drawLineLabels=function(){for(var a=1,b=this.barHeightMax,c=this.options.label_lines_font_size/2;a<this.totalLines;)this.paper.text(this.options.padding,b-a*this.lineSpacer-c+this.options.padding,a*this.inc).attr({"text-anchor":"start","font-size":this.options.label_lines_font_size,fill:this.options.line_color}),a++};c.prototype.drawBarLabels=function(){var a=0,b;for(b in this.dataset)this.paper.text(a*this.barWidth+this.barWidth/2+this.startX,this.height-(this.options.label_bars_font_size/
2-this.options.padding),b).attr({"font-size":this.options.label_bars_font_size,fill:this.options.label_bars_color}),a++};c.prototype.theme=function(a){var b={};"-min"==a.substr(a.length-4)&&(b={label_bars:!1,label_lines:!1},a=a.replace("-min",""));switch(a){case "fruit-stripe":return a={bar_palette:["#197F21","#E2DF24","#FC9D0F","#E31038"]},d.extend(a,b);case "high-contrast":return a={bar_palette:["#FF095F","#0B95F0","#0DFA21","#F8EF07","#F89407"],bg_color:["#000"],label_lines_font_size:14,label_lines_font_color:"#DDD",
label_bars_font_size:12,label_bars_color:"#DDD",line_color:"#DDD",padding:10},d.extend(a,b);case "spring-afternoon":return a={bar_palette:["#E0508E","#ECF3E1","#A5EFDE","#507E73","#533E79"]},d.extend(a,b);case "outdoorsman":return a={bar_palette:["#133423","#B4A750","#3D825F","#998E44","#63A985"]},d.extend(a,b);case "kindergarten":return a={bar_palette:["#8C3F8C","#F2D826","#F29926","#3F9926","#3F99BF"]},d.extend(a,b);default:return b}};c.prototype.closestZeroes=function(a){var b=a.toString().length,
c=Math.pow(10,b)-a,d=c.toString().length;a=parseInt(a);return b==d?a+parseInt(c.toString().slice(1,b)):a+c};jQuery(document).ready(function(a){jQuery.fn.barfly=function(a){var d=jQuery(this).selector;return this.each(function(){jQuery.data(this,d,new c(this,a,d))})}})})(jQuery);

